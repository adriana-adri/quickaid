<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>QuickAid Helpdesk</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100vh;
        /* Gradient background */
        background: linear-gradient(-45deg, #48bbc4, #3a97d1, #2772a3, #4bb9d2);
        background-size: 400% 400%;
        animation: gradientShift 15s ease infinite;
      }

      /* Animation keyframes */
      @keyframes gradientShift {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }
      .wrapper {
        display: flex;
        gap: 40px;
        align-items: flex-start;
        max-width: 1100px;
        width: 90%;
      }

      .left {
        flex: 1;
        color: white;
        padding-right: 20px;
        display: flex;
        flex-direction: column;
        justify-content: space-between; /* pushes description up, contact down */
      }

      .left h1 {
        font-size: 3.2em;
        margin-bottom: 40px;
      }

      .left p {
        font-size: 1.2em;
        line-height: 1.6;
        opacity: 0.95;
        margin-bottom: 80px; /* extra breathing room */
      }

      /* Contact block */
      .contact {
        text-align: center;
        margin-top: 40px;
      }
      .contact p {
        margin: 5px 0;
      }
      .contact .subtext {
        color: #e0e0e0;
        font-size: 0.95em;
      }
      .contact .highlight {
        font-weight: bold;
        color: #fff;
        font-size: 1.05em;
      }

      /* RIGHT SECTION (form card) */
      .right {
        flex: 1;
        background-color: white;
        padding: 30px 40px;
        border-radius: 12px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
      }

      form label {
        display: block;
        margin-top: 15px;
        color: #34495e;
        font-weight: bold;
      }

      input,
      textarea {
        width: 100%;
        padding: 10px;
        margin-top: 5px;
        border-radius: 5px;
        border: 1px solid #ccc;
        box-sizing: border-box;
        font-size: 14px;
      }

      textarea {
        resize: vertical;
        min-height: 100px;
      }

      button {
        margin-top: 20px;
        width: 100%;
        padding: 12px;
        background-color: #3498db;
        color: white;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      button:hover {
        background-color: #2980b9;
      }

      .small-btn {
        display: block; /* makes it behave like a full-width button */
        width: 100%; /* match Submit Ticket width */
        margin-top: 12px;
        padding: 12px; /* same padding as Submit Ticket */
        background-color: #f4f6f8;
        color: #3498db;
        border: 1px solid #3498db;
        border-radius: 5px;
        font-size: 16px; /* same size as Submit Ticket */
        font-weight: bold;
        text-align: center;
        text-decoration: none;
        transition: all 0.3s ease;
        box-sizing: border-box;
      }

      .small-btn:hover {
        background-color: #3498db;
        color: #fff;
      }
    </style>
  </head>
  <body>
    <div class="wrapper">
      <!-- LEFT SIDE -->
      <div class="left">
        <h1>
          QuickAid <br />
          Helpdesk üìÆ
        </h1>
        <p>
          Welcome to QuickAid Helpdesk ‚Äî your one-stop platform for reporting
          campus issues. Submit a ticket for IT problems, facility concerns, or
          lost property, and track your request in real time. You‚Äôll receive an
          email confirmation once your ticket is created.
        </p>

        <!-- Contact Information -->
        <div class="contact">
          <p class="subtext">Need urgent assistance? Contact us:</p>
          <p class="highlight">üìû (555) 123-HELP | üìß support@quickaid.edu</p>
        </div>
      </div>

      <!-- RIGHT SIDE -->
      <div class="right">
        <form id="ticketForm">
          <label for="email">Email</label>
          <input type="email" id="email" required />

          <label for="title">Title</label>
          <input type="text" id="title" required />

          <label for="category">Category</label>
          <input type="text" id="category" required />

          <label for="description">Description</label>
          <textarea id="description" required></textarea>

          <button type="submit">Submit Ticket</button>
        </form>
        <a href="view_ticket.html" class="small-btn">Check Ticket Status</a>

        <div class="success-message" id="successMessage"></div>
      </div>
    </div>

    <script>
      const BACKEND_URL =
        "https://backendquickaid-gpfkafcsh6gvbses.eastasia-01.azurewebsites.net";

      document.getElementById("ticketForm").onsubmit = async (e) => {
        e.preventDefault();

        const ticket = {
          email: document.getElementById("email").value,
          title: document.getElementById("title").value,
          category: document.getElementById("category").value,
          description: document.getElementById("description").value,
        };

        // Show loading state
        const submitButton = document.querySelector('button[type="submit"]');
        const originalText = submitButton.textContent;
        submitButton.textContent = "Submitting...";
        submitButton.disabled = true;

        const successBox = document.getElementById("successMessage");

        try {
          console.log("Submitting ticket:", ticket);

          const response = await fetch(`${BACKEND_URL}/api/submit_ticket`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Accept: "application/json",
            },
            body: JSON.stringify(ticket),
          });

          console.log("Response status:", response.status);

          if (!response.ok) {
            const errorText = await response.text();
            console.error("Error response:", errorText);
            throw new Error(`HTTP ${response.status}: ${errorText}`);
          }

          const result = await response.json();
          console.log("Success result:", result);

          document.getElementById(
            "successMessage"
          ).innerHTML = `‚úÖ Ticket submitted successfully!<br>Ticket ID: <strong>${result.id}</strong>`;
          document.getElementById("successMessage").style.color = "green";
          document.getElementById("ticketForm").reset();
        } catch (error) {
          console.error("Error submitting ticket:", error);
          document.getElementById(
            "successMessage"
          ).innerHTML = `‚ùå Error submitting ticket: ${error.message}`;
          document.getElementById("successMessage").style.color = "red";
        } finally {
          // Reset button state
          submitButton.textContent = originalText;
          submitButton.disabled = false;
        }
      };
    </script>
  </body>
</html>
